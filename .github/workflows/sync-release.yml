# .github/workflows/sync-release.yml
name: Sync Upstream Releases

on:
  workflow_dispatch:  # 手动触发
  #schedule:
    #- cron: '0 0 * * *'  # 每天自动执行一次（可选）

jobs:
  sync-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout self
        uses: actions/checkout@v3

      - name: Get latest release from upstream
        id: get_release
        uses: pozetroninc/github-action-get-latest-release@v0.5.0
        with:
          repository: zryyoung/android-sdk-custom

      - name: Download release assets
        run: |
          tag=${{ steps.get_release.outputs.release }}
          mkdir release_assets
          gh release download "$tag" -R zryyoung/android-sdk-custom -D release_assets
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Re-publish to fork
        run: |
          tag=${{ steps.get_release.outputs.release }}
          gh release create "$tag" release_assets/* \
            --repo ${{ github.repository }} \
            --title "$tag" \
            --notes "Synced from upstream"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
